# Test object literal JSON marshaling
# This should fail because object literals inherit lexical scope

# Simple object literal
pub obj1 = {{name: "test", value: 42}}
pub json1 = toJSON(value: obj1)

assert { json1 == "{\"name\":\"test\",\"value\":42}" }

# Object literal with nested structure
pub obj2 = {{user: {{id: 1, active: true}}, count: 100}}
pub json2 = toJSON(value: obj2)

# TODO: make this match defined order? or don't? maybe it's nice that it's
# stable for cache busting avoidance?
assert { json2 == "{\"count\":100,\"user\":{\"active\":true,\"id\":1}}" }

# Object literal created in function scope - this should expose the issue
pub createObject = {
	pub localVar = "local"
	{{data: localVar, timestamp: 1234567890}}
}

pub obj3 = createObject
pub json3 = toJSON(value: obj3)

assert { json3 == "{\"data\":\"local\",\"timestamp\":1234567890}" }

print("JSON marshaling tests passed!")
