# Test object literal JSON marshaling
# This should fail because object literals inherit lexical scope

# Simple object literal
pub obj1 = {{name: "test", value: 42}}
pub json1 = json(value: obj1)

assert { json1 == "{\"name\":\"test\",\"value\":42}" }

# Object literal with nested structure
pub obj2 = {{user: {{id: 1, active: true}}, count: 100}}
pub json2 = json(value: obj2)

# TODO: make this match defined order
assert { json2 == "{\"count\":100,\"user\":{\"active\":true,\"id\":1}}" }

# Object literal created in function scope - this should expose the issue
pub createObject = {
    pub localVar = "local"
    {{data: localVar, timestamp: 1234567890}}
}

pub obj3 = createObject
pub json3 = json(value: obj3)

assert { json3 == "{\"data\":\"local\",\"timestamp\":1234567890}" }

print("JSON marshaling tests passed!")
