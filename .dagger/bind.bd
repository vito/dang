# Dagger SDK directive for setting default paths
directive @defaultPath(path: String!, ignore: [String!] = []) on ARGUMENT_DEFINITION

type Bind {
  pub source: Directory!

  pub new(
    source: Directory! @defaultPath(
      path: "/",
      ignore: ["**/node_modules", "bin"]
    )
  ): Bind! {
    self.source = source
    self
  }

  pub build: File! {
    go(source).binary("./cmd/bind")
  }

  pub test: Container! {
    go(source).base.
      withDirectory("/src", source).
      withWorkdir("/src").
      withExec(["go", "test", "-v", "./..."], experimentalPrivilegedNesting: true)
  }
}
