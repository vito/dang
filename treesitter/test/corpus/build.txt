===
Build
===

#!/usr/bin/env sprout

let src = host.directory(
  "."
  include: [
    "**/*.go"
    "**/go.mod"
    "**/go.sum"
    "introspection/introspection.graphql"
  ]
)

let bin(src: Directory!): File! {
  container.
    from("golang").
    withDirectory("/src", src).
    withWorkdir("/src").
    withEnvVariable("CGO_ENABLED", "0").
    withExec(["go", "build", "-o", "/out/sprout", "./cmd/sprout"]).
    file("/out/sprout")
}

let test(bin: File!): String! {
  container.
    from("alpine").
    withFile("/bin/sprout", bin).
    withExec(["sprout", "--version"]).
    stdout
}

print(test(bin(src)))

---

(sprout
  (comment_token)
  (slot
    (value_only_slot
      (visibility
        (let_token))
      (id
        (word_token))
      (equal_token)
      (select_or_call
        (symbol_or_call
          (symbol
            (id
              (word_token))))
        (dot_token)
        (id
          (word_token))
        (arg_values
          (argument
            (positional_value
              (literal
                (string))))
          (sep)
          (argument
            (key_value
              (word_token)
              (colon_token)
              (list
                (literal
                  (string))
                (sep)
                (literal
                  (string))
                (sep)
                (literal
                  (string))
                (sep)
                (literal
                  (string))
                (sep))))
          (sep)))))
  (sep)
  (slot
    (type_and_args_and_block_slot
      (visibility
        (let_token))
      (id
        (word_token))
      (arg_types
        (arg_type
          (arg_with_type
            (id
              (word_token))
            (colon_token)
            (type
              (non_null
                (type
                  (named_type
                    (upper_id
                      (upper_token))))
                (bang_token))))))
      (colon_token)
      (type
        (non_null
          (type
            (named_type
              (upper_id
                (upper_token))))
          (bang_token)))
      (block
        (select_or_call
          (select_or_call
            (select_or_call
              (select_or_call
                (select_or_call
                  (select_or_call
                    (symbol_or_call
                      (symbol
                        (id
                          (word_token))))
                    (dot_token)
                    (id
                      (word_token))
                    (arg_values
                      (argument
                        (positional_value
                          (literal
                            (string))))))
                  (dot_token)
                  (id
                    (word_token))
                  (arg_values
                    (argument
                      (positional_value
                        (literal
                          (string))))
                    (sep
                      (comma_token))
                    (argument
                      (positional_value
                        (symbol_or_call
                          (symbol
                            (id
                              (word_token))))))))
                (dot_token)
                (id
                  (word_token))
                (arg_values
                  (argument
                    (positional_value
                      (literal
                        (string))))))
              (dot_token)
              (id
                (word_token))
              (arg_values
                (argument
                  (positional_value
                    (literal
                      (string))))
                (sep
                  (comma_token))
                (argument
                  (positional_value
                    (literal
                      (string))))))
            (dot_token)
            (id
              (word_token))
            (arg_values
              (argument
                (positional_value
                  (list
                    (literal
                      (string))
                    (sep
                      (comma_token))
                    (literal
                      (string))
                    (sep
                      (comma_token))
                    (literal
                      (string))
                    (sep
                      (comma_token))
                    (literal
                      (string))
                    (sep
                      (comma_token))
                    (literal
                      (string)))))))
          (dot_token)
          (id
            (word_token))
          (arg_values
            (argument
              (positional_value
                (literal
                  (string))))))
        (sep))))
  (sep)
  (slot
    (type_and_args_and_block_slot
      (visibility
        (let_token))
      (id
        (word_token))
      (arg_types
        (arg_type
          (arg_with_type
            (id
              (word_token))
            (colon_token)
            (type
              (non_null
                (type
                  (named_type
                    (upper_id
                      (upper_token))))
                (bang_token))))))
      (colon_token)
      (type
        (non_null
          (type
            (named_type
              (upper_id
                (upper_token))))
          (bang_token)))
      (block
        (select_or_call
          (select_or_call
            (select_or_call
              (select_or_call
                (symbol_or_call
                  (symbol
                    (id
                      (word_token))))
                (dot_token)
                (id
                  (word_token))
                (arg_values
                  (argument
                    (positional_value
                      (literal
                        (string))))))
              (dot_token)
              (id
                (word_token))
              (arg_values
                (argument
                  (positional_value
                    (literal
                      (string))))
                (sep
                  (comma_token))
                (argument
                  (positional_value
                    (symbol_or_call
                      (symbol
                        (id
                          (word_token))))))))
            (dot_token)
            (id
              (word_token))
            (arg_values
              (argument
                (positional_value
                  (list
                    (literal
                      (string))
                    (sep
                      (comma_token))
                    (literal
                      (string)))))))
          (dot_token)
          (id
            (word_token)))
        (sep))))
  (sep)
  (symbol_or_call
    (call
      (id
        (word_token))
      (arg_values
        (argument
          (positional_value
            (symbol_or_call
              (call
                (id
                  (word_token))
                (arg_values
                  (argument
                    (positional_value
                      (symbol_or_call
                        (call
                          (id
                            (word_token))
                          (arg_values
                            (argument
                              (positional_value
                                (symbol_or_call
                                  (symbol
                                    (id
                                      (word_token)))))))))))))))))))
  (sep))
